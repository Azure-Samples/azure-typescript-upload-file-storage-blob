graph TB
    User[ğŸ‘¤ User]
    
    subgraph Azure["â˜ï¸ Azure Cloud"]
        subgraph WebApp["Web App - Container Apps"]
            Frontend[ğŸŒ Frontend<br/>React + Vite]
            Backend[âš™ï¸ Backend<br/>Fastify API]
        end
        
        ManagedIdentity[ğŸ” Managed<br/>Identity]
        Registry[ğŸ‹ Container<br/>Registry]
        Storage[ğŸ—„ï¸ Storage<br/>Blob Container]
    end
    
    %% User interactions with UI buttons
    User -->|1. Click SELECT FILE| Frontend
    User -->|2. Click GET SAS TOKEN| Frontend
    User -->|7. Click UPLOAD FILE| Frontend
    
    %% SAS token flow - blue for request/response
    Frontend -->|3. Request SAS| Backend
    Backend -->|4. Get User Delegation Key| Storage
    Storage -->|5. Return Key| Backend
    Backend -->|6. Return SAS URL| Frontend
    
    %% File upload flow - green for data upload
    Frontend -->|8. Direct Upload with SAS| Storage
    
    %% File listing flow - purple for queries
    Frontend -->|9. List Files| Backend
    Backend -->|10. Query Blobs| Storage
    
    %% Authentication flow - orange dashed
    ManagedIdentity -.->|Provides Auth| Frontend
    ManagedIdentity -.->|Provides Auth| Backend
    
    %% Container images - gray dashed
    Registry -.->|Container Images| Frontend
    Registry -.->|Container Images| Backend

    %% Styling for nodes
    classDef userStyle fill:#8B5A9F,stroke:#333,stroke-width:3px,color:#fff
    classDef frontendStyle fill:#0078D4,stroke:#333,stroke-width:2px,color:#fff
    classDef backendStyle fill:#107C10,stroke:#333,stroke-width:2px,color:#fff
    classDef identityStyle fill:#FF8C00,stroke:#333,stroke-width:2px,color:#fff
    classDef registryStyle fill:#605E5C,stroke:#333,stroke-width:2px,color:#fff
    classDef storageStyle fill:#0078D4,stroke:#333,stroke-width:2px,color:#fff

    class User userStyle
    class Frontend frontendStyle
    class Backend backendStyle
    class ManagedIdentity identityStyle
    class Registry registryStyle
    class Storage storageStyle
    
    %% Link styles for colored flows
    linkStyle 0,1,2 stroke:#8B5A9F,stroke-width:3px
    linkStyle 3,4,5,6 stroke:#0078D4,stroke-width:2px
    linkStyle 7 stroke:#107C10,stroke-width:3px
    linkStyle 8,9 stroke:#9C27B0,stroke-width:2px
    linkStyle 10,11 stroke:#FF8C00,stroke-width:1px,stroke-dasharray:5
    linkStyle 12,13 stroke:#605E5C,stroke-width:1px,stroke-dasharray:5
