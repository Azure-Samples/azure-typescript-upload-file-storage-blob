graph TB
    User[ğŸ‘¤ User]
    
    subgraph Azure["â˜ï¸ Azure Cloud"]
        subgraph ContainerApps["Container Apps Environment"]
            Frontend[ğŸŒ Web App<br/>Frontend]
            Backend[âš™ï¸ API App<br/>Backend]
        end
        
        ManagedIdentity[ğŸ” Managed<br/>Identity]
        Registry[ğŸ‹ Container<br/>Registry]
        Storage[ğŸ—„ï¸ Storage<br/>Blob Container]
    end

    User -->|ğŸ‘† 1. Access| Frontend
    Frontend -->|2. Get SAS Token| Backend
    User -->|3. Upload *.PNG with SAS| Storage
    Backend -->|4. List Files| Storage
    
    ManagedIdentity -.->|Auth| Frontend
    ManagedIdentity -.->|Auth| Backend
    ManagedIdentity -.->|ACR Pull| Registry
    Registry -.->|Docker Images| Frontend
    Registry -.->|Docker Images| Backend

    classDef userStyle fill:#50E6FF,stroke:#0078D4,stroke-width:3px,color:#000
    classDef appStyle fill:#0078D4,stroke:#002050,stroke-width:2px,color:#fff
    classDef identityStyle fill:#FFB900,stroke:#D83B01,stroke-width:2px,color:#000
    classDef registryStyle fill:#00B294,stroke:#107C10,stroke-width:2px,color:#fff
    classDef storageStyle fill:#0078D4,stroke:#002050,stroke-width:3px,color:#fff

    class User userStyle
    class Frontend,Backend appStyle
    class ManagedIdentity identityStyle
    class Registry registryStyle
    class Storage storageStyle
    
    %% Link styles for colored flows
    linkStyle 0 stroke:#FF8C00,stroke-width:4px
    linkStyle 1 stroke:#0078D4,stroke-width:2px
    linkStyle 2 stroke:#107C10,stroke-width:3px
    linkStyle 3 stroke:#B4A0FF,stroke-width:2px
    linkStyle 4,5 stroke:#FFB900,stroke-width:1px,stroke-dasharray:5
    linkStyle 6,7,8 stroke:#5E5E5E,stroke-width:1px,stroke-dasharray:5
